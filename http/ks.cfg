install
cdrom
lang en_US.UTF-8
keyboard us
timezone UTC
network --onboot yes --bootproto dhcp --noipv6
bootloader --location=mbr

repo --name=base --baseurl=http://mirror.steadfast.net/centos/7.1.1503/os/x86_64/
url --url=http://mirror.steadfast.net/centos/7.1.1503/os/x86_64/
logging --level=debug

selinux --disabled
firewall --disabled
services --enabled=NetworkManager,sshd
eula --agreed

text
skipx
zerombr

clearpart --all --initlabel
autopart --nolvm --fstype=ext4

authconfig --useshadow --passalgo=sha512
rootpw --plaintext "$(openssl rand -base64 32)"
firstboot --disabled
reboot


%packages --nobase --ignoremissing
@core
sudo
%end


%post --log=/var/log/ks.post.log
systemctl disable avahi-daemon.service
systemctl disable kdump.service

sed -i -r 's@^#?PermitRootLogin.*$@PermitRootLogin no@' /etc/ssh/sshd_config
sed -i -r "s@^.*requiretty@#Defaults requiretty@" /etc/sudoers

groupadd -g 1000 centos
useradd -u 1000 -g centos -G wheel -m centos
echo 'centos:centos' | chpasswd
echo "centos	ALL=(ALL)	NOPASSWD: ALL" >> /etc/sudoers.d/centos
chmod 440 /etc/sudoers.d/centos

yum -y update
yum -y clean all
%end
